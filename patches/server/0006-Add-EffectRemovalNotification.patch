From 3039c70308411a6506118e636404addac98f6541 Mon Sep 17 00:00:00 2001
From: Shane Freeder <theboyetronic@gmail.com>
Date: Sat, 19 May 2018 01:38:55 +0100
Subject: [PATCH] Add EffectRemovalNotification

---
 src/main/java/net/minecraft/server/EntityLiving.java | 5 +++++
 src/main/java/net/minecraft/server/MobEffect.java    | 2 +-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/EntityLiving.java b/src/main/java/net/minecraft/server/EntityLiving.java
index 14637be4..f9132c33 100644
--- a/src/main/java/net/minecraft/server/EntityLiving.java
+++ b/src/main/java/net/minecraft/server/EntityLiving.java
@@ -30,9 +30,13 @@ import org.bukkit.event.entity.EntityRegainHealthEvent;
 import org.bukkit.event.entity.EntityResurrectEvent;
 import org.bukkit.event.entity.EntityTeleportEvent;
 import org.bukkit.event.player.PlayerItemConsumeEvent;
+import org.bukkit.potion.PotionEffect;
+import org.bukkit.potion.PotionEffectType;
 // CraftBukkit end
 
 import co.aikar.timings.MinecraftTimings; // Paper
+import pw.alphheim.api.events.EffectRemovalNotification; // Alphheim
+import org.bukkit.craftbukkit.potion.CraftPotionUtil; // Alphheim
 
 public abstract class EntityLiving extends Entity {
 
@@ -566,6 +570,7 @@ public abstract class EntityLiving extends Entity {
                     if (!this.world.isClientSide) {
                         iterator.remove();
                         this.b(mobeffect);
+                        new EffectRemovalNotification(this.getBukkitEntity(), CraftPotionUtil.toBukkit(mobeffect)).callEvent(); // Alphheim - event for notifying effect removal
                     }
                 } else if (mobeffect.getDuration() % 600 == 0) {
                     this.a(mobeffect, false);
diff --git a/src/main/java/net/minecraft/server/MobEffect.java b/src/main/java/net/minecraft/server/MobEffect.java
index bb292223..ef6df47b 100644
--- a/src/main/java/net/minecraft/server/MobEffect.java
+++ b/src/main/java/net/minecraft/server/MobEffect.java
@@ -183,7 +183,7 @@ public class MobEffect implements Comparable<MobEffect> {
         return (this.getDuration() <= 32147 || mobeffect.getDuration() <= 32147) && (!this.isAmbient() || !mobeffect.isAmbient()) ? ComparisonChain.start().compare(Boolean.valueOf(this.isAmbient()), Boolean.valueOf(mobeffect.isAmbient())).compare(this.getDuration(), mobeffect.getDuration()).compare(this.getMobEffect().getColor(), mobeffect.getMobEffect().getColor()).result() : ComparisonChain.start().compare(Boolean.valueOf(this.isAmbient()), Boolean.valueOf(mobeffect.isAmbient())).compare(this.getMobEffect().getColor(), mobeffect.getMobEffect().getColor()).result();
     }
 
-    public int compareTo(Object object) {
+    public int compareTo(MobEffect object) { // Alphheim - decompile fix
         return this.b((MobEffect) object);
     }
 }
-- 
2.17.1

